---
title: Windows privilege escalation
---

## Extracting NTLM hash

```powershell
mimikatz.exe
```

### From local SAM

```powershell
# Mimikatz
> privilege::debug
> token::elevate
> lsadump::sam
```

### From LSASS memory
LSASS (_Local Security Authority Subsystem Service_) is a process running on every Windows OS. It verifies users logging, handles password changes, creates access tokens, writes to the Windows Security Log. In a domain environment LSASS communicates with a Domain Controller. It manages NTLM, Kerberos, NetLogon authentication. It's not possible to use Windows without `lsass.exe` running. An attacker is able to dump the LSASS process memory and retrieve NTLM hashes.

Tips:

* Memory dump must be performed after logging in successfully. Correct data must be provided to LSASS process before extraction.
* Memory dump should be performed from SYSTEM or local Administrator account.
* Not secured LSASS memory dump can be performed using built-in Windows tools (e.g. [dump.exe](https://lolbas-project.github.io/lolbas/OtherMSBinaries/Dump64/)). Then credentials can be extracted offline.

LSASS process might have additional security layer called _LSA protection_. It can be omitted with tools like **Mimikatz**.

```powershell
# Mimikatz
> privilege::debug
> token::elevate
> sekurlsa::msv
```
