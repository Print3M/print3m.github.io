---
title: Linux pentesting notes
---

## Links, sources, wikis, tricks
- [Ired](https://www.ired.team/) - red-team tricks
- [HackTricks](https://book.hacktricks.xyz/) - hack tricks
- [ss64](https://ss64.com/) - all Powershell and Linux commands

## Quick tools
```bash
python3 -m http.server <port>               # Run HTTP server
echo "str" | base64                         # Encode with base64 
echo "str" | base64 -d                      # Decode with base64 
```

## Kali Linux resources
**Wordlists**
```bash
/usr/share/wordlists                        # Location of wordlists 
/usr/share/wordlists/rockyou.txt            # Most common passwords
/usr/share/seclists                         # Well grouped wordlists
```

**Binaries**
```bash
/usr/share/windows-resources                # Tools for Windows
sqlitebrowser <db-file>                     # Nice browser for SQLite DB
```

## Remote password bruteforcing
```bash
# Check all combinations (protocols: ssh, smb, mssql, ldap, winrm)
crackmepexec <protocol> <ip> -u <usernames> -p <passwords>

# FTP credentials bruteforcing
hydra -L <username-file> -P <passwords-file> ftp://<ip>
```

## Exploitation
### Reverse shells
[RevShells](https://www.revshells.com/) - reverse shells generator
```bash
nc -lvnp <port>                             # Listener
```

### Exploits
**Searchsploit**
```bash
searchsploit --update                       # Update local DB
searchsploit <phrase>                       # Search in Exploit-DB
searchsploit -m <exploit-path>              # Copy exploit to cwd
usr/share/exploitdb/exploits/               # Default path of Exploit-DB
```

**Metasploit**
```bash
msfdb init                                  # Init Metasploit DB
msfconsole                                  # Run metasploit
> search <regex>                            # Search for exploit
> use <exploit-path>                        # Use exploit
> options                                   # Lists options
> set <OPTION> <VALUE>                      # Set option
> run                                       # Run exploit
> back                                      # Exit exploit view

# To get reverse shell (run listener): exploit/multi/handler
> CTRL + z                                  # Background current session
> sessions                                  # List all sessions
> sessions <num>                            # Restore session
```

### SQLMap / mysql
#### Custom middleware 
Hint: to extend SQLMap capabilities you can write simple HTTP server as middleware. It gets payloads from SQLMap and passes them further doing some magic on the fly. With middleware like that you can help SQLMap with complex behaviours and responses.
    
**Privileges**
[List of MySQL DBMS privileges.](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html)

**Usage**
```bash
# Some params to speed up process
sqlmap <params> --batch --threads 10 --dbms mysql
sqlmap -r <file.req>                        # Use request from file

# Try to get shell by SQLi (POST and GET)
# There is also "--sql-shell" flag to get SQL shell
sqlmap -u <domain> --data "<param>=*" --method POST --os-shell
sqlmap -u <domain?param=*> --os-shell
    
# Dump selected columns (-C) from table (-T) from DB (-D)
sqlmap <params> -D <db> -T <table> -C <c1>,<c2> --dump

# Discover
-dbs                                        # Show databases
-D <db> --tables                            # Show tables
    
sqlmap <params>:
    --file-read <path>                      # Read file
    --file-write <file> --file-dest <to>    # Upload file
    --current-user                          # Get current username
    --current-db                            # Get current DB
    --privileges                            # List user privileges
    --proxy <http://ip:port>                # Send requests via proxy
    --random-agent                          # Random user-agent

mysql -h <host> -u <user> [-p <pass>]       # Connect to SQL server
> show databases;                           # Get all databases
> use <db-name>;                            # Select database                 
> show tables;                              # Get all tables
> select user();                            # Get current user
> show grants;                              # Get current permissions
```

### AJP - Apache JServ Protocol
**Exploits**
- GhostCat (LFI)

**Enumeration**
```bash
nmap -sV --script ajp-auth,ajp-headers,ajp-methods,ajp-request -Pn -p 8009 <IP>
```

## Post-exploitation
### Interesting files to loot
```bash
# System configs
/etc/shadow                                 # Password hashes (root)
/etc/sudoers                                # List of sudoers (root)
/etc/passwd                                 # All users
/etc/group                                  # All groups
/etc/hostname                               # Hostname
/etc/issue                                  # Linux distro
/etc/*-release                              # Linux distro
/etc/crontab                                # CRON
/etc/hosts                                  # Routing
/etc/syslog.conf                            # 
/etc/resolv.conf                            # DNS
/etc/sysctl.conf                            # Kernel
/etc/aliases                                # Aliases
/var/run/utmp                               # Current user info
/var/log/wtmp                               # Login and logouts info

# Logs
/var/log/auth.log                           # Auth attempts logs
/var/log/nginx/access.log                   # Nginx HTTP logs
/var/log/syslog                             # OS events
/var/log/faillog                            # Failed login attempts

# User's information 
/home/<u>/.viminfo
/home/<u>/.bash_history                     
/home/<u>/.mysql_history
/home/<u>/.ssh/id_rsa                       # SSH private key
/home/<u>/.ssh/authorized_keys
/home/<u>/.ssh/known_hosts

# Software configs
/etc/nginx/sites-enabled/default            # Nginx website settings
/etc/nginx/nginx.conf                       # Nginx
/etc/http.conf                              # Apache
/etc/samba/smb.conf                         # SMB
/etc/mysql/my.cnf                           # MySQL
/etc/postfix/main.cf                        # Postfix SMTP
/etc/ssh/sshd_config                        # SSHd
/var/run/sshd.pid                           # SSHd PID

.ssh/authorized_keysplaye
.ssh/authorized_keys2
/etc/ssh/ssh_host_rsa_key
/home/<u>/.rhosts
/home/<u>/.shosts
/var/run/sshd.pid
/usr/lib/openssh/sftp-server

# Self process
/proc/self/comm                             # Command
/proc/self/status                           # Detailed info
```

### Privilege escalation
- [GTFO Bins](https://gtfobins.github.io/) - commands to perform priv-escalaction

**Shell upgrading**
```bash
which python python2 python3
python3 -c "import pty; pty.spawn('/usr/bin/bash')"
script /dev/null -c bash
```

**Weakness discovering**
```bash
sudo -ll                                    # List user's privileges
sudo -v                                     # Check sudo rights for user
find <dir> -perm /u=s 2>/dev/null           # Find SUID files
w                                           # Show logged-in users
last                                        # Show last logged-in users
```

### Hash cracking
- [CrackStation](https://crackstation.net/) - crack common MD5 hashes

```bash
hashid -m <hash-string>                     # Identify hash algorithm        

john --wordlist=<wordlist> <hash-file>      # Brute-force hash
zip2john <file.zip> > hash                  # Get pass hash from zip

hashcat <hash-file> <wordlist>              # Crack hash (auto-detect)
hashcat -m 0 <hash-file> <wordlist>         # Crack hash (MD5 mode)
hashcat -h | grep "Hash modes" -A400        # Get all modes
```

### Connecting
**SSH private key**
```bash
ssh <user>@<ip> -i <private-key-file>       # Auth by private key
```

**FTP as a guest**
```bash
ftp anonymous@<ip>                          # Connect to FTP (as guest)
```
 
**MongoDB CLI**
```bash
mongo <ip>:<port>                           # Connect to MongoDB
> show dbs                                  # List databases
> use <db>                                  # Switch to database
> show collections                          # List collections (tables)
> db.<collection>.find().pretty()           # List data of collection
. db.<collection>.updateOne()               # Update one record
```